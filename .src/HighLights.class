' Gambas class file



Public aBackup As Variant[][] = []

Public Sub Form_Open()
 If Me.Grid1.Rows.Count = 0 Then
  Grid1.Columns.Count = 3
  Grid1.Columns[0].Text = "Int"
  Grid1.Columns[0].Width = Grid1.Font.TextWidth("000") + 4
  Grid1.Columns[1].Text = "Val"
  Grid1.Columns[2].Text = "Name"
 Endif
 Me.Title = "Setting highlight colours for ''" & FMain.TextEditor1.Highlight & "' mode'"
HighLights.Tag = False
Grid1.Columns.Sort = 2
AddColours()
End

Public Sub AddColours()

Grid1.Rows.Count = 0 
AC(Highlight.Background, "Background")
AC(Highlight.Normal, "Normal")
AC(Highlight.Keyword, "Keyword")
AC(Highlight.Function, "Function")
AC(Highlight.Operator, "Operator")
AC(Highlight.Symbol, "Symbol")
AC(Highlight.Number, "Number")
AC(Highlight.String, "String")
AC(Highlight.Comment, "Comment")
AC(Highlight.Breakpoint, "Breakpoint")
AC(Highlight.Current, "Current")
AC(Highlight.Datatype, "Datatype")
AC(Highlight.Selection, "Selection")
AC(Highlight.Highlight, "Highlight")
AC(Highlight.CurrentLine, "CurrentLine")
AC(Highlight.Error, "Error")
AC(Highlight.Help, "Help")
AC(Highlight.Preprocessor, "Preprocessor")
AC(Highlight.Escape, "Escape")
AC(Highlight.Label, "Label")
AC(Highlight.Constant, "Constant")
'AC(Highlight.Alternate, "Alternate")
'AC(Highlight.Added, "Added")
'AC(Highlight.Removed, "Removed")
'AC(Highlight.Custom, "Custom")
Grid1.Columns.Sort = -1
MakeBackup()
Grid1.Rows[0].Selected = True

  
End

Public Sub Form_Close()
  
  If HighLights.Tag <> True Then Btn_Revert_Click()
  
End


Public Sub AC(i As Integer, s As String)
  
  Grid1.Rows.Count += 1
  Grid1[Grid1.Rows.Max, 0].Text = Str(i)
  Grid1[Grid1.Rows.Max, 1].Text = Str(FMain.TextEditor1.Styles[i].Color)
  Grid1[Grid1.Rows.Max, 2].Text = s
  If i <> 0 Then Grid1[Grid1.Rows.Max, 0].Foreground = FMain.TextEditor1.Styles[i].Color
End


Public Sub Grid1_Select()
Me.HBox2.Enabled = (Grid1.Row <> 0)
  Me.ColorChooser1.Value = Val(Grid1[Grid1.Row, 1].Text)
  Me.CBox_Bold.Value = FMain.TextEditor1.Styles[Val(Grid1[Grid1.Row, 0].Text)].Bold
  Me.CBox_UnderLine.Value = FMain.TextEditor1.Styles[Val(Grid1[Grid1.Row, 0].Text)].Underline
End

Public Sub ColorChooser1_Change()
Grid1[Grid1.Row, 1].Text = Str(Last.Value)
FMain.TextEditor1.Styles[Val(Grid1[Grid1.Row, 0].text)].Color = Last.Value
If Grid1.row <> 0 Then 
Grid1[Grid1.Row, 0].Foreground = Last.Value
Else
Grid1.Background = Last.Value
Endif
End

Public Sub Btn_Save_Click()
  Dim c, v As Integer, sVar As String
  For c = 0 To Grid1.Rows.Max
    sVar = Grid1[c, 1].Text
    If c <> 0 Then
      v = Val(Grid1[c, 0].Text)
      sVar &= "," & Str(FMain.TextEditor1.Styles[v].Bold)
      sVar &= "," & Str(FMain.TextEditor1.Styles[v].Underline)
    Endif
    Settings["Highlights-" & Lower(FMain.TextEditor1.Highlight) & "/" & Grid1[c, 2].Text] = sVar
  Next
Settings.Save()
HighLights.Tag = True
HighLights.Close()
End

Public Sub Grid1_Sort()
If Grid1.Columns.Sort = -1 Then Return

  Dim Values, ValueSorted As New String[]
  Dim Nx, iNx As Integer
  For Nx = 0 To Grid1.Rows.Max
    Values.Add(Grid1[Nx, Grid1.Columns.Sort].Text)
  Next
  ValueSorted = Values.Copy()
  ValueSorted.Sort()
  For Nx = 0 To ValueSorted.Max
    For iNx = 0 To Grid1.Columns.Max
      Swap Grid1[Nx, iNx].Text, Grid1[Values.Find(ValueSorted[Nx], 0, Nx), iNx].Text
    Next
    Values.Clear()
    For iNx = 0 To Grid1.Rows.Max
      Values.Add(Grid1[iNx, Grid1.Columns.Sort].Text)
    Next
  Next
  Grid1.Refresh()
End

Public Sub Btn_Revert_Click()
Dim c As Integer
For c = 0 To Grid1.Rows.Max
  Grid1[c, 1].Text = Str(aBackup[c][0])
  If c <> 0 Then 
  Grid1[c, 0].Foreground = aBackup[c][0]
  FMain.TextEditor1.Styles[Val(Grid1[c, 0].Text)].Bold = aBackup[c][1]
  FMain.TextEditor1.Styles[Val(Grid1[c, 0].Text)].Underline = aBackup[c][2]
  Endif
  FMain.TextEditor1.Styles[Val(Grid1[c, 0].Text)].Color = aBackup[c][0]
Next
Grid1.Background = aBackup[0][0]
Grid1.Rows[0].Selected = True
End

Public Sub MakeBackup()
Dim c, v As Integer
With FMain.TextEditor1
For c = 0 To Grid1.Rows.Max
 v = Val(Grid1[c, 0].Text)
 aBackup.Add([.Styles[v].Color, .Styles[v].Bold, .Styles[v].Underline])
Next
End With
End

Public Sub CBox_Bold_Click()

  FMain.TextEditor1.Styles[Val(Grid1[Grid1.Row, 0].Text)].Bold = Last.Value

End
Public Sub CBox_UnderLine_Click()

  FMain.TextEditor1.Styles[Val(Grid1[Grid1.Row, 0].Text)].Underline = Last.Value

End
